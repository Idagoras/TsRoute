package model

import (
	"encoding/json"
	"fmt"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestRouteJoin(t *testing.T){
	rt_1_Str := `{"origin":"113.35169,23.13555","destination":"113.26201,23.12899","distance":"9023","taxi_cost":"","transits":[{"cost":{"duration":"3241","transit_fee":"2.0","taxi_cost":""},"nightflag":"0","walking_distance":"1145","distance":"10497","segments":[{"walking":{"destination":"113.347755,23.136297","distance":"408","origin":"113.351685,23.135551","cost":{"duration":"349","transit_fee":"","taxi_cost":""},"steps":[{"instruction":"沿中山大道西辅路步行408米到达师大暨大","road":"中山大道西辅路","distance":"408"}]},"bus":{"buslines":[{"departure_stop":{"name":"师大暨大","id":"440100017356044","location":"113.348059,23.136243"},"arrival_stop":{"name":"中山纪念堂(连新路)","id":"440100017356059","location":"113.263427,23.132197"},"name":"B4A路(科学城(揽月路)总站--广仁路总站)","id":"440100017356","type":"快速公交系统","distance":"9352","cost":{"duration":"2260","transit_fee":"","taxi_cost":""},"bus_time_tips":"下一班车06:45发出","bustimetag":"2","start_time":"0645","end_time":"2030","via_num":"10","via_stops":[{"name":"岗顶站","id":"440100017356045","location":"113.338565,23.134594"},{"name":"石牌桥","id":"440100017356046","location":"113.331549,23.133470"},{"name":"体育中心","id":"440100017356047","location":"113.323683,23.133798"},{"name":"锦城花园","id":"440100017356048","location":"113.310373,23.131782"},{"name":"东峻广场","id":"440100017356030","location":"113.306779,23.131927"},{"name":"东风东路站","id":"440100017356031","location":"113.302227,23.131814"},{"name":"肿瘤医院","id":"440100017356032","location":"113.289566,23.130894"},{"name":"越秀桥","id":"440100017356049","location":"113.279930,23.131152"},{"name":"正骨医院","id":"440100017356034","location":"113.273723,23.131051"},{"name":"东风中路","id":"440100017356035","location":"113.270264,23.131180"}]},{"departure_stop":{"name":"师大暨大","id":"440100017360043","location":"113.347750,23.136300"},"arrival_stop":{"name":"中山纪念堂(连新路)","id":"440100017360050","location":"113.263427,23.132197"},"name":"B4路(天河智慧城核心区总站(高唐)--广仁路总站)","id":"440100017360","type":"快速公交系统","distance":"9315","cost":{"duration":"2155","transit_fee":"","taxi_cost":""},"bus_time_tips":"下一班车06:00发出","bustimetag":"2","start_time":"","end_time":"","via_num":"11","via_stops":[{"name":"岗顶","id":"440100017360044","location":"113.338794,23.134699"},{"name":"BRT岗顶N2","id":"440100017360054","location":"113.338300,23.134489"},{"name":"石牌桥","id":"440100017360045","location":"113.331273,23.133483"},{"name":"体育中心","id":"440100017360046","location":"113.323516,23.133806"},{"name":"锦城花园","id":"440100017360047","location":"113.310200,23.131820"},{"name":"东峻广场","id":"440100017360027","location":"113.306779,23.131927"},{"name":"东风东路站","id":"440100017360028","location":"113.302227,23.131814"},{"name":"肿瘤医院","id":"440100017360029","location":"113.289566,23.130894"},{"name":"越秀桥","id":"440100017360030","location":"113.279869,23.131151"},{"name":"正骨医院","id":"440100017360031","location":"113.273620,23.131046"},{"name":"东风中路","id":"440100017360032","location":"113.270264,23.131180"}]}]}},{"walking":{"destination":"113.262009,23.128994","distance":"737","origin":"113.263428,23.132196","cost":{"duration":"631","transit_fee":"","taxi_cost":""},"steps":[{"instruction":"沿连新路步行11米向右前方行走","road":"连新路","distance":"11"},{"instruction":"步行8米左转","road":"","distance":"8"},{"instruction":"沿连新路步行18米向右前方行走","road":"连新路","distance":"18"},{"instruction":"沿连新路步行37米右转","road":"连新路","distance":"37"},{"instruction":"沿东风中路步行103米右转","road":"东风中路","distance":"103"},{"instruction":"沿解放北路辅路步行105米左转","road":"解放北路辅路","distance":"105"},{"instruction":"步行20米左转","road":"","distance":"20"},{"instruction":"沿解放北路辅路步行54米向右前方行走","road":"解放北路辅路","distance":"54"},{"instruction":"步行95米右转","road":"","distance":"95"},{"instruction":"沿解放北路辅路步行215米往前走","road":"解放北路辅路","distance":"215"},{"instruction":"沿解放北路步行71米","road":"解放北路","distance":"71"}]},"bus":{"buslines":null}}]}]}`
	rt_2_Str := `{"origin":"113.26201,23.12899","destination":"113.26474,23.11407","distance":"1768","taxi_cost":"","transits":[{"cost":{"duration":"915","transit_fee":"2.0","taxi_cost":""},"nightflag":"0","walking_distance":"127","distance":"1909","segments":[{"walking":{"destination":"113.262009,23.128990","distance":"1","origin":"113.262009,23.128990","cost":{"duration":"0","transit_fee":"","taxi_cost":""},"steps":[{"instruction":"步行1米到达迎宾馆","road":"","distance":"1"}]},"bus":{"buslines":[{"departure_stop":{"name":"迎宾馆","id":"440100016415010","location":"113.262011,23.128991"},"arrival_stop":{"name":"海珠广场(一德东)","id":"440100016415025","location":"113.264311,23.114704"},"name":"253路(罗冲围总站(松南路)--瑞宝乡总站)","id":"440100016415","type":"普通公交线路","distance":"1782","cost":{"duration":"807","transit_fee":"","taxi_cost":""},"bus_time_tips":"下一班车06:00发出","bustimetag":"2","start_time":"","end_time":"","via_num":"2","via_stops":[{"name":"解放中路","id":"440100016415011","location":"113.262339,23.122530"},{"name":"解放南路","id":"440100016415012","location":"113.262635,23.119080"}]},{"departure_stop":{"name":"迎宾馆","id":"440100016499007","location":"113.262011,23.128991"},"arrival_stop":{"name":"海珠广场(一德东)","id":"440100016499031","location":"113.264311,23.114704"},"name":"29路(站南路总站--纸厂总站)","id":"440100016499","type":"普通公交线路","distance":"1782","cost":{"duration":"1247","transit_fee":"","taxi_cost":""},"bus_time_tips":"下一班车06:30发出","bustimetag":"2","start_time":"","end_time":"","via_num":"2","via_stops":[{"name":"解放中路","id":"440100016499008","location":"113.262339,23.122530"},{"name":"解放南路","id":"440100016499009","location":"113.262635,23.119080"}]},{"departure_stop":{"name":"迎宾馆","id":"440100016266006","location":"113.262011,23.128991"},"arrival_stop":{"name":"海珠广场(一德东)","id":"440100016266044","location":"113.264311,23.114704"},"name":"180路(解放北路总站(应元路口)--南洲路总站(小洲南路口))","id":"440100016266","type":"普通公交线路","distance":"1782","cost":{"duration":"913","transit_fee":"","taxi_cost":""},"bus_time_tips":"下一班车05:50发出","bustimetag":"2","start_time":"","end_time":"","via_num":"2","via_stops":[{"name":"解放中路","id":"440100016266007","location":"113.262339,23.122530"},{"name":"解放南路","id":"440100016266008","location":"113.262635,23.119080"}]}]}},{"walking":{"destination":"113.264748,23.114071","distance":"126","origin":"113.264313,23.114700","cost":{"duration":"108","transit_fee":"","taxi_cost":""},"steps":[{"instruction":"沿一德路步行39米右转","road":"一德路","distance":"39"},{"instruction":"沿侨光西路步行87米","road":"侨光西路","distance":"87"}]},"bus":{"buslines":null}}]}]}`
	var route1 Route
	var route2 Route
	err := json.Unmarshal([]byte(rt_1_Str),&route1)
	require.NoError(t, err)
	err = json.Unmarshal([]byte(rt_2_Str),&route2)
	require.NoError(t, err)
	newRoute := route1.Join(&route2)
	jsonByte, err := json.Marshal(newRoute)
	require.NoError(t,err)
	fmt.Println(string(jsonByte))
}